<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quên Mật Khẩu - Hệ thống RAG cho Cơ sở dữ liệu</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div class="flex flex-col items-center justify-center px-6 py-8 mx-auto md:h-screen lg:py-0">
        <a href="index.html" class="flex items-center mb-6 text-2xl font-semibold text-gray-900 dark:text-white">
            <img class="w-10 h-10 mr-2" src="assets/images/logo.svg" alt="logo">
            Hệ thống RAG
        </a>
        <div class="w-full bg-white rounded-lg shadow dark:border md:mt-0 sm:max-w-md xl:p-0 dark:bg-gray-800 dark:border-gray-700">
            <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
                <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white">
                    Quên mật khẩu
                </h1>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    Nhập email của bạn và chúng tôi sẽ gửi cho bạn một liên kết để đặt lại mật khẩu.
                </p>
                <div id="error-message" class="hidden p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800" role="alert"></div>
                <div id="success-message" class="hidden p-4 mb-4 text-sm text-green-700 bg-green-100 rounded-lg dark:bg-green-200 dark:text-green-800" role="alert"></div>
                <form id="forgot-password-form" class="space-y-4 md:space-y-6">
                    <div>
                        <label for="email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Email của bạn</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                <i class="fas fa-envelope text-gray-500 dark:text-gray-400"></i>
                            </div>
                            <input type="email" name="email" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="name@company.com" required>
                        </div>
                    </div>
                    <button type="submit" id="submit-button" class="w-full text-white bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
                        Gửi liên kết đặt lại mật khẩu
                    </button>
                    <div class="flex items-center justify-between">
                        <a href="login.html" class="text-sm font-medium text-primary-600 hover:underline dark:text-primary-500">
                            Quay lại đăng nhập
                        </a>
                        <a href="signup.html" class="text-sm font-medium text-primary-600 hover:underline dark:text-primary-500">
                            Đăng ký tài khoản mới
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="assets/js/api-service.js"></script>
    <script>
        // Lấy các phần tử DOM
        const form = document.getElementById('forgot-password-form');
        const emailInput = document.getElementById('email');
        const submitButton = document.getElementById('submit-button');
        const errorMessage = document.getElementById('error-message');
        const successMessage = document.getElementById('success-message');

        // Xử lý submit form
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Ẩn các thông báo
            errorMessage.classList.add('hidden');
            successMessage.classList.add('hidden');
            
            // Lấy giá trị email
            const email = emailInput.value.trim();
            
            // Kiểm tra email có hợp lệ không
            if (!email) {
                showError('Vui lòng nhập email của bạn.');
                return;
            }
            
            // Vô hiệu hóa nút submit và hiển thị trạng thái đang xử lý
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang xử lý...';
            
            try {
                // Lấy URL chuyển hướng
                const redirectTo = 'http://localhost:3000/reset-password';
                
                // Gọi API quên mật khẩu
                const response = await apiService.forgotPassword(email, redirectTo);
                
                // Hiển thị thông báo thành công
                showSuccess(response.message || 'Yêu cầu đặt lại mật khẩu đã được gửi đến email của bạn. Vui lòng kiểm tra hộp thư.');
                
                // Xóa giá trị input
                emailInput.value = '';
            } catch (error) {
                // Hiển thị thông báo lỗi
                const errorDetail = error.response?.data?.detail || 'Đã xảy ra lỗi khi gửi yêu cầu đặt lại mật khẩu.';
                showError(errorDetail);
            } finally {
                // Khôi phục nút submit
                submitButton.disabled = false;
                submitButton.innerHTML = 'Gửi liên kết đặt lại mật khẩu';
            }
        });
        
        // Hàm hiển thị thông báo lỗi
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            successMessage.classList.add('hidden');
        }
        
        // Hàm hiển thị thông báo thành công
        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');
        }
    </script>
</body>
</html> 